// Story data structure - Plot holes patched
const story = [
    // ACT 1 - THE DYING CITY
    {
        text: "The city doesn't sleep. It just pretends to, between the sirens.",
        section: "act1",
        ambientLight: "neon-red"
    },
    {
        text: "You are Ash. Memory runner. Digital thief.",
        section: "act1"
    },
    {
        text: "You steal what people want to forget and sell it to those who can't remember.",
        section: "act1"
    },
    {
        text: "The irony is that you'd pay anything to forget too. But memories are currency. And you're broke in every way that matters.",
        section: "act1"
    },
    {
        text: "It's not clean work. But clean work doesn't exist. Not here. Not anymore.",
        section: "act1"
    },
    {
        text: "You don't talk to people. Can't afford to. Every connection is a liability. Every name you know is a target.",
        section: "act1"
    },
    {
        text: "You work alone. Sleep alone. Exist alone.",
        section: "act1"
    },
    {
        text: "The neon signs flicker outside your window—half of them broken, the other half selling lies.",
        section: "act1",
        ambientLight: "neon-blue"
    },
    {
        text: "PARADISE AWAITS. NEW YOU IN 30 DAYS. FORGET YOUR PAIN.",
        section: "act1"
    },
    {
        text: "The smog is thick tonight. It's always thick. Some days you can barely see the building across the street.",
        section: "act1"
    },
    {
        text: "Some days you wonder if there's anything out there at all. If the city just ends and becomes nothing.",
        section: "act1"
    },
    {
        text: "If you walked far enough, would you just disappear into gray?",
        section: "act1"
    },
    {
        text: "Would anyone notice?",
        section: "act1"
    },
    {
        text: "Your apartment is small. One room. A mattress on the floor. Neural cables hanging from the ceiling like nooses.",
        section: "act1"
    },
    {
        text: "You've thought about it. Everyone has. The cables can handle more than data transfer.",
        section: "act1"
    },
    {
        text: "But you're a coward. Too scared to die, too tired to live.",
        section: "act1",
        ambientLight: "cold-purple"
    },
    {
        text: "The walls are stained with water damage that looks like maps of countries that don't exist anymore.",
        section: "act1"
    },
    {
        text: "Sometimes you trace them with your fingers. Wonder if they were better. If anywhere was ever better.",
        section: "act1"
    },
    {
        text: "You probably wouldn't have fit in there either.",
        section: "act1"
    },
    {
        text: "You have one rule: never sell memories of people who still matter to someone alive.",
        section: "act1"
    },
    {
        text: "Break that rule, and you're dead. Or worse—you become a product.",
        section: "act1",
        ambientLight: "danger-red"
    },
    {
        text: "You've seen it happen. Runners who got greedy. Who sold the wrong memory to the wrong person.",
        section: "act1"
    },
    {
        text: "They're still alive, technically. Walking around with empty eyes and corporate barcodes tattooed on their necks.",
        section: "act1"
    },
    {
        text: "Human storage drives. Nothing left inside but someone else's data.",
        section: "act1"
    },
    {
        text: "You saw one last week. She was begging outside the transit station. Not for money—for deletion.",
        section: "act1"
    },
    {
        text: "She kept screaming that she could feel the data inside her head. That it was eating her. That she wanted to die but couldn't.",
        section: "act1"
    },
    {
        text: "Corporate property can't self-terminate. They have failsafes. She'll beg forever.",
        section: "act1"
    },
    {
        text: "You walked past her. Everyone did. What else can you do?",
        section: "act1"
    },
    {
        text: "You tell yourself you're different. That you won't end up like her.",
        section: "act1"
    },
    {
        text: "You're lying. You always end up lying.",
        section: "act1"
    },
    {
        text: "Every runner ends up the same. Product or corpse. Just a matter of time.",
        section: "act1",
        ambientLight: "cold-purple"
    },
    {
        text: "Your neural port is glitching. Cheap cables, cheap maintenance. You can't afford better.",
        section: "act1"
    },
    {
        text: "If it fails completely, you're done. Can't run memories without hardware.",
        section: "act1"
    },
    {
        text: "You need a mechanic. Someone in the industrial quarter who doesn't ask questions.",
        section: "act1"
    },
    {
        text: "Where the buildings lean into each other like they're too tired to stand alone.",
        section: "act1"
    },
    {
        text: "Where people jump from the roofs so often they installed nets. Not to save them. To catch the bodies before they damage the pavement.",
        section: "act1"
    },
    {
        text: "You take the transit. The train car smells like piss and copper. Blood, probably. There's always blood.",
        section: "act1"
    },
    {
        text: "A man sleeps in the corner. Or maybe he's dead. You don't check. Not your problem.",
        section: "act1"
    },
    {
        text: "A girl with chrome eyes stares at you. They don't blink. Can't blink.",
        section: "act1"
    },
    {
        text: "You wonder what she traded for them. What she gave up. If it was worth it.",
        section: "act1"
    },
    {
        text: "You stare back. She looks away first. Everyone does. Eye contact means trouble.",
        section: "act1"
    },
    {
        text: "The shop is tucked between a pawn broker and a corpse disposal unit. No sign. Just a red light above a metal door.",
        section: "act1",
        ambientLight: "neon-red"
    },
    {
        text: "You knock twice. The door opens automatically. No one's there.",
        section: "act1"
    },
    {
        text: "Inside, the shop is cluttered with parts. Circuit boards. Synthetic organs. Half-assembled limbs hanging from hooks.",
        section: "act1"
    },
    {
        text: "It smells like solder and something rotting. Like every other shop trying to keep broken people functional.",
        section: "act1"
    },
    {
        text: "There's a woman at the workbench, hunched over something small and sparking.",
        section: "act1",
        ambientLight: "neon-cyan"
    },
    {
        text: "She doesn't look up. Doesn't acknowledge you.",
        section: "act1"
    },
    {
        text: "Ash: Port's glitching. Need it fixed.",
        section: "act1"
    },
    {
        text: "She still doesn't look up.\n\n\n\nMechanic: Payment upfront. No questions, no small talk, no names.",
        section: "act1"
    },
    {
        text: "Ash: Fine.",
        section: "act1"
    },
    {
        text: "You transfer half your credits. Everything you have. She checks the transfer, then gestures to a chair.",
        section: "act1"
    },
    {
        text: "The chair is cracked leather. Stained with old blood. You sit.",
        section: "act1"
    },
    {
        text: "You tilt your head, exposing the port at the base of your skull.",
        section: "act1"
    },
    {
        text: "The most vulnerable part of you. The part that keeps you useful. The part that keeps you alive.",
        section: "act1"
    },
    {
        text: "She could kill you right now. Slice your spinal cord. Harvest your implants.",
        section: "act1"
    },
    {
        text: "Part of you almost hopes she does.",
        section: "act1"
    },
    {
        text: "Her hands are cold when they touch your neck. Cybernetic. Military grade. You notice scars where the metal meets flesh.",
        section: "act1"
    },
    {
        text: "Corporate work. The expensive kind. The kind that comes with a price.",
        section: "act1"
    },
    {
        text: "Mechanic: Corroded cable. You're lucky you're not dead.\n\n\n\nShe disconnects it without gentleness.",
        section: "act1"
    },
    {
        text: "The disconnect sends a spike of pain through your skull. You don't make a sound. Can't show weakness.",
        section: "act1"
    },
    {
        text: "She slots in a new cable. Clean signal. No static.",
        section: "act1"
    },
    {
        text: "You stand. Transfer the rest of your payment. Now you're completely broke.",
        section: "act1"
    },
    {
        text: "She's already back at her workbench. Doesn't say goodbye. Doesn't care.",
        section: "act1"
    },
    {
        text: "You leave. The door locks behind you with a heavy thunk.",
        section: "act1"
    },
    {
        text: "You walk three blocks. Stop on a bridge overlooking the industrial sector.",
        section: "act1",
        ambientLight: "cold-purple"
    },
    {
        text: "The drop is sixty feet. Onto concrete. Quick. Clean.",
        section: "act1"
    },
    {
        text: "You've stood here before. Lots of people have. You can tell by the scratches on the railing. Messages. Goodbyes.",
        section: "act1"
    },
    {
        text: "Someone carved FINALLY into the metal. You run your fingers over it.",
        section: "act1"
    },
    {
        text: "You're broke now. No credits. No food. The cable will last a few months, maybe.",
        section: "act1"
    },
    {
        text: "Then you'll need another repair. Another payment you can't afford.",
        section: "act1"
    },
    {
        text: "The cycle never ends. Work, break, repair, work. Until the day you can't pay anymore.",
        section: "act1"
    },
    {
        text: "Then you become product.",
        section: "act1"
    },
    {
        text: "You grip the railing. It would be so easy.",
        section: "act1"
    },
    {
        text: "But you keep walking. Not tonight. Maybe tomorrow.",
        section: "act1"
    },
    {
        text: "You always say tomorrow.",
        section: "act1"
    },
    {
        text: "Two weeks later, your port glitches again. Different problem. You need the same mechanic.",
        section: "act1"
    },
    {
        text: "You have no money. You know what that means.",
        section: "act1"
    },
    {
        text: "But you go anyway. Because the alternative is dying slowly, port degrading until it fries your brain.",
        section: "act1"
    },
    {
        text: "The shop door opens. She's there. Doesn't look up.",
        section: "act1"
    },
    {
        text: "Ash: I don't have money.",
        section: "act1"
    },
    {
        text: "Mechanic: Then leave.",
        section: "act1"
    },
    {
        text: "Ash: I'll die if you don't fix it.",
        section: "act1"
    },
    {
        text: "Mechanic: Not my problem.",
        section: "act1"
    },
    {
        text: "You stand there. Waiting for something. You don't know what.",
        section: "act1"
    },
    {
        text: "She finally looks at you. Her eyes are gray. Empty. Dead.",
        section: "act1"
    },
    {
        text: "Mechanic: Sit down.",
        section: "act1",
        ambientLight: "neon-cyan"
    },
    {
        text: "Ash: Why?",
        section: "act1"
    },
    {
        text: "Mechanic: Because I need you alive. For now.",
        section: "act1"
    },
    {
        text: "You don't understand. But you sit. You don't have a choice.",
        section: "act1"
    },
    {
        text: "She fixes your port. Doesn't charge you. Doesn't explain.",
        section: "act1"
    },
    {
        text: "When she's done, she hands you a data chip. Encrypted. Corporate grade.",
        section: "act1"
    },
    {
        text: "Mechanic: Deliver this. Address is on the chip. You get half the payment.",
        section: "act1"
    },
    {
        text: "Ash: What's on it?",
        section: "act1"
    },
    {
        text: "Mechanic: Not your concern. Deliver it or starve. Your choice.",
        section: "act1"
    },
    {
        text: "You take the chip. You always do. Survival over morals. That's the rule.",
        section: "act1"
    },
    {
        text: "You start running jobs for her. Small things. Data transfers. Hardware pickups. Illegal work.",
        section: "act1"
    },
    {
        text: "She pays enough to keep you alive. Barely.",
        section: "act1"
    },
    {
        text: "You never talk beyond the transactions. She doesn't want to know you. You don't want to be known.",
        section: "act1"
    },
    {
        text: "That's better. Safer.",
        section: "act1"
    },
    {
        text: "Three months pass. You stop going to the bridge as often.",
        section: "act1"
    },
    {
        text: "Not because things are better. Just because you're too busy staying alive.",
        section: "act1"
    },
    {
        text: "That's when the real message comes.",
        section: "act1",
        ambientLight: "danger-red"
    },

    // ACT 2 - THE JOB
    {
        text: "The message arrives at 3 AM. Anonymous sender. Corporate encryption.",
        section: "act2",
        glitch: true
    },
    {
        text: "You almost delete it. But the payment amount stops you.",
        section: "act2"
    },
    {
        text: "Enough money to leave the city. Enough to disappear. Enough to finally stop.",
        section: "act2"
    },
    {
        text: "The job: extract a specific memory set from a high-level executive's personal archive.",
        section: "act2"
    },
    {
        text: "Except there's no executive. The memory set is locked inside your head.",
        section: "act2",
        ambientLight: "neon-cyan"
    },
    {
        text: "You read the file three times. It doesn't make sense.",
        section: "act2"
    },
    {
        text: "Two years ago, you brokered a deal. Sold someone to the corporation. A mechanic.",
        section: "act2"
    },
    {
        text: "The deal went bad. You tried to back out. They didn't let you.",
        section: "act2"
    },
    {
        text: "As punishment—or insurance—they used you as a test subject. Wiped your memories of the deal. Of her.",
        section: "act2"
    },
    {
        text: "Stored classified data in your brain as a backup. Then released you with a new identity chip.",
        section: "act2"
    },
    {
        text: "New face. New name. New life. You don't even remember being someone else.",
        section: "act2"
    },
    {
        text: "The corporation lost track of you after the wipe. Budget cuts. System failures. Bureaucratic rot.",
        section: "act2"
    },
    {
        text: "Two years of searching. And now they found you. Now they want their data back.",
        section: "act2"
    },
    {
        text: "The extraction is dangerous. Could fry your neural system. Could kill you.",
        section: "act2",
        ambientLight: "danger-red"
    },
    {
        text: "But if it works, you walk away rich. Free. Done.",
        section: "act2"
    },
    {
        text: "You stare at the contract. At the payment amount. At the risk assessment: 73% fatality rate.",
        section: "act2"
    },
    {
        text: "73% chance you die. 27% chance you're free. Those are better odds than the bridge.",
        section: "act2"
    },
    {
        text: "You message the mechanic. Tell her you need extraction equipment. Medical grade.",
        section: "act2"
    },
    {
        text: "She responds immediately.\n\n\n\nMechanic: Price?",
        section: "act2"
    },
    {
        text: "You send her the contract details. Everything.",
        section: "act2"
    },
    {
        text: "Long silence.\n\n\n\nMechanic: Come to the shop. Midnight.",
        section: "act2"
    },
    {
        text: "When you arrive, the shop is dark except for a single work light.",
        section: "act2",
        ambientLight: "neon-cyan"
    },
    {
        text: "She's set up medical equipment. Neural interface. Stabilizers. Everything you need.",
        section: "act2"
    },
    {
        text: "Ash: How much?",
        section: "act2"
    },
    {
        text: "Mechanic: Nothing. I'll do it for free.",
        section: "act2"
    },
    {
        text: "Ash: Why?",
        section: "act2"
    },
    {
        text: "Mechanic: Because I need to see what's in your head.",
        section: "act2"
    },
    {
        text: "That doesn't make sense. But nothing about this makes sense.",
        section: "act2"
    },
    {
        text: "Mechanic: If your heart stops, I can restart it. If your brain hemorrhages, you're dead. Understand?",
        section: "act2"
    },
    {
        text: "Ash: Understood.",
        section: "act2"
    },
    {
        text: "You sit. She connects the cables. The interface goes live.",
        section: "act2"
    },
    {
        text: "The first extraction pulls fragments. Pieces of a life you don't remember.",
        section: "act2",
        glitch: true,
        ambientLight: "memory-flash"
    },
    {
        text: "A woman's face. Young. Terrified. Screaming.",
        section: "act2"
    },
    {
        text: "Please don't do this. Please. We can figure something else out—",
        section: "act2"
    },
    {
        text: "The memory cuts. You're back in the chair. Blood running from your nose.",
        section: "act2"
    },
    {
        text: "The mechanic wipes your face. Rough. Clinical. No care.",
        section: "act2"
    },
    {
        text: "Mechanic: You saw something.",
        section: "act2"
    },
    {
        text: "Ash: A woman. Don't know who.",
        section: "act2"
    },
    {
        text: "Mechanic: We'll go again.",
        section: "act2"
    },
    {
        text: "The sessions continue. Each one pulls more fragments. More faces. More screaming.",
        section: "act2"
    },
    {
        text: "The woman again. Different memory. Her hands—flesh hands—reaching toward you.",
        section: "act2",
        glitch: true
    },
    {
        text: "But the memory is corrupted. You can't see her face clearly. Can't hear what she's saying.",
        section: "act2"
    },
    {
        text: "Just fragments. Just pain.",
        section: "act2"
    },
    {
        text: "Another session. The woman crying. Bandages on her arms. Blood soaking through.",
        section: "act2"
    },
    {
        text: "They took my hands. They took everything—",
        section: "act2"
    },
    {
        text: "Static. Pain. You wake up on the floor.",
        section: "act2"
    },
    {
        text: "The mechanic is standing over you. Her face is unreadable. Her metal hands are fists.",
        section: "act2"
    },
    {
        text: "Mechanic: One more extraction. Final one.",
        section: "act2"
    },
    {
        text: "You don't argue. You never do.",
        section: "act2"
    },
    {
        text: "She maxes the stabilizers. This one will hurt more.",
        section: "act2"
    },
    {
        text: "If something goes wrong—",
        section: "act2"
    },
    {
        text: "Ash: Then I die. I know.",
        section: "act2"
    },
    {
        text: "She connects the cables.",
        section: "act2"
    },
    {
        text: "Everything goes wrong.",
        section: "act2",
        ambientLight: "danger-red"
    },

    // ACT 3 - THE TRUTH
    {
        text: "The final extraction tears something open.",
        section: "act3",
        glitch: true,
        ambientLight: "memory-flash"
    },
    {
        text: "Not fragments this time. A full memory. Complete. Undamaged.",
        section: "act3"
    },
    {
        text: "You're in a shop. This shop.",
        section: "act3"
    },
    {
        text: "But it's different. Cleaner. The woman at the workbench has flesh hands.",
        section: "act3"
    },
    {
        text: "It's her. The woman from the memories.",
        section: "act3"
    },
    {
        text: "She's younger. No scars. No dead eyes.",
        section: "act3",
        glitch: true
    },
    {
        text: "Your old face is reflected in the metal. A face you don't recognize. Before they changed you.",
        section: "act3"
    },
    {
        text: "Ash (past): I need you to do something for me.",
        section: "act3"
    },
    {
        text: "What?",
        section: "act3"
    },
    {
        text: "Ash (past): There's a job. Big payout. I need you to store some data for me. Temporarily.",
        section: "act3"
    },
    {
        text: "The memory shifts. Fast-forward. Same shop. Different night.",
        section: "act3"
    },
    {
        text: "Young Mechanic: You said temporary. It's been three weeks. Get this out of my head.",
        section: "act3"
    },
    {
        text: "Ash (past): Just a few more days. The buyer's almost ready.",
        section: "act3"
    },
    {
        text: "Young Mechanic: I don't care about your buyer. Get it out. Now.",
        section: "act3"
    },
    {
        text: "Ash (past): I can't. Not yet. Just trust me.",
        section: "act3"
    },
    {
        text: "The memory fragments. Corrupted. Pieces missing.",
        section: "act3",
        glitch: true
    },
    {
        text: "You're handing over data. Corporate brokers. Credits transferring.",
        section: "act3"
    },
    {
        text: "Then shouting. Security. The woman being dragged away.",
        section: "act3"
    },
    {
        text: "You sold me! You knew they wanted me, not the data—",
        section: "act3"
    },
    {
        text: "I didn't—I thought—",
        section: "act3"
    },
    {
        text: "You're lying! You always lie!",
        section: "act3"
    },
    {
        text: "Metal restraints. Surgical table. Her hands strapped down.",
        section: "act3",
        ambientLight: "danger-red"
    },
    {
        text: "Please. I'm a mechanic. I need my hands. Please don't—",
        section: "act3"
    },
    {
        text: "The saw starts.",
        section: "act3",
        glitch: true
    },
    {
        text: "Her screaming.",
        section: "act3"
    },
    {
        text: "You standing there. Watching. Counting your payment.",
        section: "act3"
    },
    {
        text: "Then corporate security turning on you. The deal was always a trap. For both of you.",
        section: "act3"
    },
    {
        text: "They drag you to another room. Strap you down. Wipe your memories. Give you a new face.",
        section: "act3"
    },
    {
        text: "Make you forget her. Forget what you did. Forget who you were.",
        section: "act3"
    },
    {
        text: "Then nothing.",
        section: "act3"
    },
    {
        text: "You wake up on the floor. Present day. Blood everywhere.",
        section: "act3",
        ambientLight: "neon-red"
    },
    {
        text: "The mechanic is standing over you. Her metal hands clenched into fists.",
        section: "act3"
    },
    {
        text: "You remember.",
        section: "act3"
    },
    {
        text: "You're her. I—Your voice breaks. I did that to you.",
        section: "act3"
    },
    {
        text: "Yes.",
        section: "act3"
    },
    {
        text: "Ash: You've known this whole time. Since the first day.",
        section: "act3"
    },
    {
        text: "Riven: Yes. The corporation changed your face, but I recognized your neural signature. Your port. Your walking pattern.",
        section: "act3"
    },
    {
        text: "Riven: I've been tracking you for two years. Waiting for them to find you. Waiting for this.",
        section: "act3"
    },
    {
        text: "Ash: Why didn't you just kill me?",
        section: "act3"
    },
    {
        text: "Riven: Because death is too easy. You don't get to escape.",
        section: "act3",
        ambientLight: "cold-purple"
    },
    {
        text: "She pulls out a data chip.\n\n\n\nRiven: This is what's really in your head. Not corporate secrets. A virus.",
        section: "act3"
    },
    {
        text: "Riven: I've been building it for two years. Every session, every job, every time you came back.",
        section: "act3"
    },
    {
        text: "Riven: When you upload it to the client, it'll destroy their entire memory trafficking network.",
        section: "act3"
    },
    {
        text: "Riven: Thousands of people freed. The whole system burned down.",
        section: "act3"
    },
    {
        text: "Ash: What happens to me?",
        section: "act3"
    },
    {
        text: "Riven: The upload will erase you. Your mind. Your personality. Everything.",
        section: "act3",
        glitch: true
    },
    {
        text: "Riven: You'll still be breathing. But you won't be you anymore.",
        section: "act3"
    },
    {
        text: "Riven: You'll be nothing. Just like you made me nothing.",
        section: "act3"
    },
    {
        text: "You stare at her. At those metal hands. At the face you destroyed.",
        section: "act3"
    },
    {
        text: "Ash: I never cared about you, did I? In the memory. I just used you.",
        section: "act3"
    },
    {
        text: "Yes.",
        section: "act3"
    },
    {
        text: "Ash: And I'd do it again. I haven't changed.",
        section: "act3"
    },
    {
        text: "I know.",
        section: "act3"
    },
    {
        text: "Ash: So why give me a choice?",
        section: "act3"
    },
    {
        text: "Riven: Because either way, you suffer. Complete the upload, you're erased. Abort it, you live knowing what you are.",
        section: "act3"
    },
    {
        text: "She places the upload device in your hand.",
        section: "act3"
    },
    {
        text: "Choose.",
        section: "act3",
        ambientLight: "danger-red"
    },

    // THE CHOICE
    {
        text: "The upload device sits in your hand. You don't deserve mercy. You never did.",
        section: "choice",
        isChoice: true,
        prompt: "What do you do?",
        choices: [
            { text: "Abort the upload. Keep existing. Keep being the monster you are.", path: "abortEnd" }\n\n        ]\n\n    }\n\n];\n\n\n\n// Different endings\n\nconst endings = {\n\n    uploadEnd: [\n\n        {\n\n            text: "You plug in the device.",
            section: "uploadEnd"
        },
        {
            text: "She doesn't move. Doesn't stop you. Just watches.",
            section: "uploadEnd"
        },
        {
            text: "Riven: You're really going to do it.",
            section: "uploadEnd"
        },
        {
            text: "Ash: Yeah. It's what I deserve.",
            section: "uploadEnd"
        },
        {
            text: "The upload begins.",
            section: "uploadEnd",
            glitch: true,
            ambientLight: "danger-red"
        },
        {
            text: "You can feel it immediately—code ripping through your mind like broken glass.",
            section: "uploadEnd"
        },
        {
            text: "Every memory burning. Every thought dissolving. Everything that makes you Ash turning to ash.",
            section: "uploadEnd"
        },
        {
            text: "Your legs give out. You hit the floor hard.",
            section: "uploadEnd"
        },
        {
            text: "She doesn't catch you. Just stands there. Watching you die.",
            section: "uploadEnd"
        },
        {
            text: "Through the connection, you can feel the network burning. Thousands of stolen memories being freed.",
            section: "uploadEnd"
        },
        {
            text: "People waking up. Remembering. Being human again.",
            section: "uploadEnd"
        },
        {
            text: "It's not redemption. Nothing can redeem what you did.",
            section: "uploadEnd"
        },
        {
            text: "But it's something. Maybe.",
            section: "uploadEnd",
            ambientLight: "neon-cyan"
        },
        {
            text: "You try to speak. To apologize. But the words won't come.",
            section: "uploadEnd"
        },
        {
            text: "She watches. Her face is stone.",
            section: "uploadEnd"
        },
        {
            text: "Everything is fading. The pain. The guilt. The memories.",
            section: "uploadEnd"
        },
        {
            text: "You're disappearing. Piece by piece. Becoming nothing.",
            section: "uploadEnd"
        },
        {
            text: "It doesn't feel like relief. It just feels like ending.",
            section: "uploadEnd",
            ambientLight: "death-fade"
        },
        {
            text: "—",
            section: "uploadEnd"
        },
        {
            text: "—",
            section: "uploadEnd"
        },
        {
            text: "—",
            section: "uploadEnd"
        },
        {
            text: "Three weeks later.",
            section: "uploadEnd",
            ambientLight: "neon-blue"
        },
        {
            text: "Riven returns to her shop. The door still opens automatically.",
            section: "uploadEnd"
        },
        {
            text: "There's someone in the corner. Sitting. Staring at nothing.",
            section: "uploadEnd"
        },
        {
            text: "It's you. Your body. Your new face. Empty eyes.",
            section: "uploadEnd"
        },
        {
            text: "She kept you alive. With illegal life support. Black market nutrients. Medical debt she'll never pay off.",
            section: "uploadEnd"
        },
        {
            text: "Maybe spite. Maybe because killing you would be mercy. Maybe because she needs to see what she made.",
            section: "uploadEnd"
        },
        {
            text: "You don't recognize her. Don't recognize anything.",
            section: "uploadEnd"
        },
        {
            text: "Sometimes you make sounds. Not words. Just... sounds.",
            section: "uploadEnd"
        },
        {
            text: "She feeds you. Keeps you functional. You're a pet. A trophy. A reminder.",
            section: "uploadEnd"
        },
        {
            text: "A customer comes in. Sees you.\n\n\n\nCustomer: What's that?",
            section: "uploadEnd"
        },
        {
            text: "Riven: Nothing important.",
            section: "uploadEnd"
        },
        {
            text: "She goes back to work. Soldering. Building. Fixing.",
            section: "uploadEnd"
        },
        {
            text: "Her hands don't shake anymore. They stopped the night you erased yourself.",
            section: "uploadEnd"
        },
        {
            text: "She still doesn't talk to anyone. Still works alone. Still waits to die.",
            section: "uploadEnd",
            ambientLight: "cold-purple"
        },
        {
            text: "Revenge didn't fix her. Nothing will.",
            section: "uploadEnd"
        },
        {
            text: "But at least you're suffering. At least she's not alone in that.",
            section: "uploadEnd"
        },
        {
            text: "At least there's that.",
            section: "uploadEnd"
        },
        {
            text: "END",
            section: "end"
        }
    ],

    abortEnd: [
        {
            text: "You abort the upload.",
            section: "abortEnd"
        },
        {
            text: "The device goes dark. The connection severs. The fire in your head stops.",
            section: "abortEnd"
        },
        {
            text: "She doesn't look surprised. She knew.",
            section: "abortEnd"
        },
        {
            text: "Riven: Of course. Of course you'd choose yourself. You always do.",
            section: "abortEnd"
        },
        {
            text: "I—",
            section: "abortEnd"
        },
        {
            text: "Riven: Get out.",
            section: "abortEnd"
        },
        {
            text: "You can't find words. There are no words.",
            section: "abortEnd"
        },
        {
            text: "Riven: You ruined me, and you'd do it again. You're exactly what I thought you were.",
            section: "abortEnd"
        },
        {
            text: "Riven: GET OUT.",
            section: "abortEnd",
            ambientLight: "danger-red"
        },
        {
            text: "You hear them before you see them. Boots. Corporate security.",
            section: "abortEnd"
        },
        {
            text: "The failed upload triggered an alert. They're here for you. For the data still in your head.",
            section: "abortEnd"
        },
        {
            text: "She pulls a gun from under the workbench.",
            section: "abortEnd"
        },
        {
            text: "Riven: Go. Back door.",
            section: "abortEnd"
        },
        {
            text: "Why are you—",
            section: "abortEnd"
        },
        {
            text: "Riven: I'm not helping you. I'm making sure you live long enough to suffer.",
            section: "abortEnd"
        },
        {
            text: "The door bursts open. You run.",
            section: "abortEnd"
        },
        {
            text: "Gunfire behind you. Shouting. Breaking glass.",
            section: "abortEnd",
            glitch: true
        },
        {
            text: "You keep running. You don't look back.",
            section: "abortEnd"
        },
        {
            text: "You can't.",
            section: "abortEnd"
        },
        {
            text: "—",
            section: "abortEnd"
        },
        {
            text: "—",
            section: "abortEnd"
        },
        {
            text: "—",
            section: "abortEnd"
        },
        {
            text: "Two months later.",
            section: "abortEnd",
            ambientLight: "neon-blue"
        },
        {
            text: "You're still in the city. Still running memories. Still alive.",
            section: "abortEnd"
        },
        {
            text: "The corporation found you three weeks ago. Made you an offer.",
            section: "abortEnd"
        },
        {
            text: "Work for them, or become product. You chose work.",
            section: "abortEnd"
        },
        {
            text: "Of course you did.",
            section: "abortEnd"
        },
        {
            text: "They already extracted their data remotely after the failed upload. Pulled it clean while you were running.",
            section: "abortEnd"
        },
        {
            text: "Then they wiped everything related to her. To Riven. Every memory of the shop, the jobs, the repairs.",
            section: "abortEnd"
        },
        {
            text: "Punishment for aborting. Insurance against liability. Standard corporate procedure.",
            section: "abortEnd"
        },
        {
            text: "The jobs are worse now. Darker. They know what you are. What you did.",
            section: "abortEnd"
        },
        {
            text: "They use that. Send you after people like her. People who fight back.",
            section: "abortEnd"
        },
        {
            text: "You do it. Because the alternative is becoming nothing.",
            section: "abortEnd"
        },
        {
            text: "You go to the bridge sometimes. Stand there. Look at the scratches on the railing.",
            section: "abortEnd",
            ambientLight: "cold-purple"
        },
        {
            text: "Someone added a new one. COWARD.",
            section: "abortEnd"
        },
        {
            text: "You run your fingers over it. You know it's about you.",
            section: "abortEnd"
        },
        {
            text: "But you keep walking. You always do.",
            section: "abortEnd"
        },
        {
            text: "One night, you're walking past the industrial quarter. You see a shop. Something about it feels familiar.",
            section: "abortEnd"
        },
        {
            text: "The red light is off. The door is sealed. Condemned.",
            section: "abortEnd"
        },
        {
            text: "You check the records later. The owner died two months ago. Shootout with corporate security.",
            section: "abortEnd"
        },
        {
            text: "She took four of them with her. Fought to the end.",
            section: "abortEnd"
        },
        {
            text: "You feel nothing. Or maybe you feel everything. You can't tell anymore.",
            section: "abortEnd"
        },
        {
            text: "You don't remember her name. Don't remember her face. The wipe was thorough.",
            section: "abortEnd"
        },
        {
            text: "But something in your chest aches when you look at that sealed door.",
            section: "abortEnd"
        },
        {
            text: "Like you lost something important. Something that mattered.",
            section: "abortEnd"
        },
        {
            text: "You're still broke. Still alone. Still waiting to die.",
            section: "abortEnd"
        },
        {
            text: "But you won't jump. You never will.",
            section: "abortEnd",
            ambientLight: "cold-purple"
        },
        {
            text: "That night, you stand on the bridge again. Look at the drop.",
            section: "abortEnd"
        },
        {
            text: "Sixty feet. Concrete. Quick. Clean.",
            section: "abortEnd"
        },
        {
            text: "You pull out a knife. Add your own message to the railing.",
            section: "abortEnd"
        },
        {
            text: "TOMORROW.",
            section: "abortEnd"
        },
        {
            text: "Then you keep walking. Because you're a coward. Because tomorrow never comes.",
            section: "abortEnd"
        },
        {
            text: "Because this is what you deserve. To keep living. To keep existing.",
            section: "abortEnd"
        },
        {
            text: "To carry this hollow ache you can't explain and can't remember.",
            section: "abortEnd"
        },
        {
            text: "Forever.",
            section: "abortEnd",
            ambientLight: "death-fade"
        },
        {
            text: "END",
            section: "end"
        }
    ]
};

// Game state
let currentIndex = 0;
let currentPath = story;
let choiceMade = false;
let gameStarted = false;

// DOM elements
let introScreen;
let startBtn;
let storyWrapper;
let storyText;
let continueBtn;
let choiceContainer;
let choicePrompt;
let choice1;
let choice2;
let progressFill;
let glitchOverlay;
let ambientLights;

// Initialize
function init() {
    console.log('Initializing game...');

    // Get intro elements
    introScreen = document.getElementById('intro-screen');
    startBtn = document.getElementById('start-btn');

    // Get story elements
    storyWrapper = document.getElementById('story-wrapper');
    storyText = document.getElementById('story-text');
    continueBtn = document.getElementById('continue-btn');
    choiceContainer = document.getElementById('choice-container');
    choicePrompt = document.getElementById('choice-prompt');
    choice1 = document.getElementById('choice1');
    choice2 = document.getElementById('choice2');
    progressFill = document.getElementById('progress-fill');
    glitchOverlay = document.getElementById('glitch-overlay');
    ambientLights = document.getElementById('ambient-lights');

    console.log('All elements found, attaching listeners...');

    // Set up start button
    startBtn.addEventListener('click', startGame);

    // Set up continue button
    continueBtn.addEventListener('click', nextStory);

    console.log('Initialization complete!');
}

// Start game - fade out intro
function startGame() {
    console.log('Starting game...');
    gameStarted = true;

    // Fade out intro screen
    introScreen.classList.add('fade-out');

    // After fade, show story and start
    setTimeout(() => {
        introScreen.style.display = 'none';
        storyWrapper.classList.add('visible');
        displayStory();
    }, 1000);
}

// Set ambient lighting
function setAmbientLight(lightClass) {
    if (!lightClass) {
        // Clear all lights
        ambientLights.className = 'ambient-lights';
        return;
    }

    // Remove all light classes and add new one
    ambientLights.className = 'ambient-lights active ' + lightClass;
}

// Display current story segment
function displayStory() {
    const current = currentPath[currentIndex];

    if (!current) {
        console.error('No story at index:', currentIndex);
        return;
    }

    // Set ambient lighting if specified
    if (current.ambientLight) {
        setAmbientLight(current.ambientLight);
    }

    // Reset and hide choice container
    choiceContainer.classList.add('hidden');
    continueBtn.classList.remove('hidden');

    // Check if this is a choice point
    if (current.isChoice) {
        displayChoice(current);
        return;
    }

    // Apply glitch effect if specified
    if (current.glitch) {
        storyText.classList.add('glitch');
        glitchOverlay.style.opacity = '0.3';
        setTimeout(() => {
            storyText.classList.remove('glitch');
            glitchOverlay.style.opacity = '0';
        }, 300);
    }

    // Fade out, change text, fade in
    storyText.style.opacity = '0';
    setTimeout(() => {
        storyText.textContent = current.text;
        storyText.style.opacity = '1';
    }, 400);

    // Update progress
    updateProgress();

    // Check if this is the end
    if (current.section === 'end') {
        continueBtn.innerHTML = 'RESTART';
        continueBtn.onclick = restart;
    }
}

// Display choice
function displayChoice(current) {
    continueBtn.classList.add('hidden');

    storyText.style.opacity = '0';
    setTimeout(() => {
        storyText.textContent = current.text;
        storyText.style.opacity = '1';
    }, 400);

    setTimeout(() => {
        choicePrompt.textContent = current.prompt;
        choice1.textContent = current.choices[0].text;
        choice2.textContent = current.choices[1].text;

        choiceContainer.classList.remove('hidden');

        choice1.onclick = () => makeChoice(current.choices[0].path);
        choice2.onclick = () => makeChoice(current.choices[1].path);
    }, 800);
}

// Handle choice selection
function makeChoice(path) {
    if (choiceMade) return;
    choiceMade = true;

    // Apply glitch effect
    glitchOverlay.style.opacity = '0.5';
    setTimeout(() => {
        glitchOverlay.style.opacity = '0';
    }, 400);

    // Switch to the chosen ending path
    currentPath = endings[path];
    currentIndex = 0;

    setTimeout(() => {
        choiceContainer.classList.add('hidden');
        displayStory();
    }, 1000);
}

// Next story segment
function nextStory() {
    if (currentIndex < currentPath.length - 1) {
        currentIndex++;
        displayStory();
    }
}

// Update progress bar
function updateProgress() {
    const progress = (currentIndex / currentPath.length) * 100;
    progressFill.style.width = progress + '%';
}

// Restart game
function restart() {
    currentIndex = 0;
    currentPath = story;
    choiceMade = false;
    gameStarted = false;

    // Clear ambient lights
    setAmbientLight(null);

    storyWrapper.classList.remove('visible');
    introScreen.style.display = 'flex';
    introScreen.classList.remove('fade-out');

    continueBtn.innerHTML = '<span>CONTINUE</span><span class="arrow">â-¶</span>';
    continueBtn.onclick = nextStory;
}

// Start when DOM is ready
document.addEventListener('DOMContentLoaded', init);
